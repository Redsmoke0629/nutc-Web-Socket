<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Echo æ©Ÿå™¨äºº</title>
</head>
<body>
    <h2>ğŸ¤– 1å°1 Echo æ©Ÿå™¨äººæ¸¬è©¦</h2>
    <div id="status">ç‹€æ…‹ï¼šæº–å‚™ä¸­...</div>
    <div id="output" style="border:1px solid #333; height: 150px; overflow-y: scroll; padding: 10px; background: #f0f0f0;"></div>

    <!-- æ–°å¢åå­—è¼¸å…¥æ¡† -->
    <input type="text" id="name" placeholder="ä½ çš„åå­—" value="è¨ªå®¢" style="width: 80px;">
    <input type="text" id="msg" placeholder="è¼¸å…¥æ¸¬è©¦è¨Šæ¯...">
    <button onclick="send()">ç™¼é€</button>

    <script>
        // 1. å»ºç«‹é€£ç·š (æ³¨æ„ï¼šé€™è£¡æ˜¯ ws:// é–‹é ­)
        const socket = new WebSocket('ws://localhost:8080');
        const output = document.getElementById('output');
        const statusDiv = document.getElementById('status');

        // 2. ç›£è½é€£ç·šé–‹å•Ÿ
        socket.onopen = function(event) {
            console.log('é€£ç·šæˆåŠŸï¼');
            statusDiv.innerText = 'ç‹€æ…‹ï¼šğŸŸ¢ å·²é€£ç·š';
            statusDiv.style.color = 'green';
        };

        // 3. ç›£è½æ”¶åˆ°è¨Šæ¯ (Server å‚³å›ä¾†çš„ Echo)
        socket.onmessage = function(event) {
            const newMsg = document.createElement('div');
            newMsg.innerText = event.data;
            newMsg.style.color = 'blue';
            output.appendChild(newMsg);

            // è‡ªå‹•æ²å‹•åˆ°åº•éƒ¨
            output.scrollTop = output.scrollHeight;
        };

        // 4. ç›£è½é€£ç·šé—œé–‰
        socket.onclose = function(event) {
            statusDiv.innerText = 'ç‹€æ…‹ï¼šğŸ”´ å·²æ–·ç·š';
            statusDiv.style.color = 'red';
        };

        // 5. ç›£è½éŒ¯èª¤
        socket.onerror = function(event) {
            statusDiv.innerText = 'ç‹€æ…‹ï¼šâš ï¸ ç™¼ç”ŸéŒ¯èª¤';
        };

        // ç™¼é€è¨Šæ¯çš„åŠŸèƒ½ (ä¿®æ”¹ç‰ˆ)
        function send() {
            const nameInput = document.getElementById('name');
            const msgInput = document.getElementById('msg');

            if(msgInput.value) {
                // é¡¯ç¤ºè‡ªå·±æ‰“çš„å­— (å‰ç«¯è‡ªå·±å…ˆé¡¯ç¤º)
                const myMsg = document.createElement('div');
                myMsg.innerText = `${nameInput.value} (æˆ‘)ï¼š${msgInput.value}`;
                output.appendChild(myMsg);

                // æº–å‚™è¦å‚³çµ¦ Server çš„è³‡æ–™ç‰©ä»¶
                const payload = {
                    name: nameInput.value,
                    text: msgInput.value
                };

                // è½‰æˆ JSON å­—ä¸²å¾Œç™¼é€
                socket.send(JSON.stringify(payload));

                msgInput.value = ''; // æ¸…ç©ºè¨Šæ¯æ¡†ï¼Œä¿ç•™åå­—
            }
        }
    </script>
</body>
</html>